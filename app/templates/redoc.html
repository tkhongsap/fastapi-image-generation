<!DOCTYPE html>
<html>
<head>
    <title>{{ title }}</title>
    <!-- needed for adaptive design -->
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="shortcut icon" href="https://fastapi.tiangolo.com/img/favicon.png">
    <style>
        :root {
            --accent-color: #9f6eff;
            --accent-light: #eb5cff;
            --accent-dark: #4bbdff;
            --bg-color: #0d0d10;
            --card-bg: #1a1a24;
            --text-primary: #ffffff;
            --text-secondary: rgba(255, 255, 255, 0.7);
            --border-color: rgba(255, 255, 255, 0.12);
        }
        
        body {
            margin: 0;
            padding: 0;
            background-color: var(--bg-color);
            color: var(--text-primary);
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
        }
        
        /* ReDoc Container */
        redoc {
            display: block;
        }
        
        /* Override ReDoc core styles - must use !important */
        :root .redoc-wrap {
            background-color: var(--bg-color) !important;
        }
        
        :root .menu-content {
            background-color: var(--card-bg) !important;
            border-right: 1px solid var(--border-color) !important;
        }
        
        :root .menu-content label {
            color: var(--text-primary) !important;
        }
        
        :root .menu-content a {
            color: var(--text-secondary) !important;
        }
        
        :root .menu-content a:hover {
            color: var(--text-primary) !important;
        }
        
        /* Active menu item */
        :root .menu-content li[data-item-id] label.active {
            background-color: rgba(159, 110, 255, 0.1) !important;
            color: var(--accent-color) !important;
        }
        
        /* API Info section */
        :root .api-info h1 {
            color: var(--text-primary) !important;
            font-weight: 700 !important;
            font-size: 32px !important;
        }
        
        :root .api-info p {
            color: var(--text-secondary) !important;
        }
        
        /* API endpoints */
        :root [data-section-id] {
            background-color: var(--card-bg) !important;
            color: var(--text-primary) !important;
            border-radius: 8px !important;
            margin-bottom: 12px !important;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15) !important;
            overflow: hidden !important;
        }
        
        /* Operation method labels */
        :root [data-section-id] .operation-type {
            border-radius: 4px !important;
            font-weight: 600 !important;
        }
        
        /* Endpoint path */
        :root .operation-path {
            color: var(--text-primary) !important;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', 'Consolas', monospace !important;
        }
        
        /* Parameters section */
        :root .params-wrap {
            background-color: var(--card-bg) !important;
            border: 1px solid var(--border-color) !important;
            border-radius: 8px !important;
        }
        
        /* Parameter row */
        :root .param-name {
            color: var(--accent-color) !important;
            font-weight: 600 !important;
        }
        
        /* Code samples */
        :root .react-tabs__tab-panel, :root .tab-content {
            background-color: rgba(0, 0, 0, 0.3) !important;
            border-radius: 4px !important;
        }
        
        :root pre {
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', 'Consolas', monospace !important;
            font-size: 13px !important;
        }
        
        /* Schema section */
        :root .schema {
            color: var(--text-primary) !important;
            background-color: var(--card-bg) !important;
            border-radius: 4px !important;
        }
        
        /* Loading animation */
        .loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 16px;
        }
        
        .spinner {
            width: 50px;
            height: 50px;
            border: 3px solid rgba(159, 110, 255, 0.3);
            border-radius: 50%;
            border-top-color: var(--accent-color);
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
    <link rel="stylesheet" href="/static/css/redoc-theme.css">
</head>
<body>
    <div class="loading" id="loading">
        <div class="spinner"></div>
        <div>Loading API Documentation...</div>
    </div>
    
    <noscript>
        ReDoc requires Javascript to function. Please enable it to browse the documentation.
    </noscript>
    
    <redoc spec-url="{{ openapi_url }}"></redoc>
    
    <script src="{{ redoc_js_url }}"></script>
    <script>
        // Handle loading state
        const loadingElement = document.getElementById('loading');
        
        // Add a timeout to hide the loading indicator if it takes too long
        const loadingTimeout = setTimeout(() => {
            if (loadingElement.style.display !== 'none') {
                loadingElement.style.display = 'none';
                console.info('Loading timeout reached, hiding loading indicator');
            }
        }, 5000); // 5 second timeout
        
        // Listen for the DOM to be fully loaded
        document.addEventListener('DOMContentLoaded', function() {
            try {
                // Simplified initialization approach
                const options = {
                    scrollYOffset: 0,
                    hideDownloadButton: false,
                    expandResponses: '200,201',
                    theme: {
                        colors: {
                            primary: { main: '#9f6eff' },
                            text: {
                                primary: '#ffffff',
                                secondary: 'rgba(255, 255, 255, 0.7)'
                            },
                            http: {
                                get: '#22c55e',
                                post: '#3b82f6',
                                put: '#f59e0b',
                                delete: '#ef4444'
                            }
                        },
                        typography: {
                            fontFamily: "'Inter', -apple-system, BlinkMacSystemFont, sans-serif",
                            fontSize: '16px',
                            headings: { fontWeight: '600' },
                            code: { fontFamily: "'Monaco', 'Menlo', 'Ubuntu Mono', 'Consolas', monospace" }
                        },
                        sidebar: {
                            backgroundColor: '#1a1a24',
                            textColor: '#ffffff',
                            activeTextColor: '#9f6eff'
                        }
                    }
                };
                
                // Initialize ReDoc with the OpenAPI spec URL
                Redoc.init('{{ openapi_url }}', options)
                    .then(() => {
                        // Success! Hide the loading indicator
                        loadingElement.style.display = 'none';
                        clearTimeout(loadingTimeout);
                        
                        // Force redoc to recalculate heights correctly
                        setTimeout(() => {
                            window.dispatchEvent(new Event('resize'));
                        }, 300);
                    })
                    .catch(error => {
                        console.error('ReDoc initialization error:', error);
                        loadingElement.style.display = 'none';
                        clearTimeout(loadingTimeout);
                        
                        // Show a simple error message
                        document.querySelector('redoc').innerHTML = `
                            <div style="padding: 2rem; text-align: center;">
                                <h2 style="color: var(--text-primary);">Error Loading API Documentation</h2>
                                <p style="color: var(--text-secondary);">
                                    There was a problem loading the API documentation.
                                    Please try refreshing the page.
                                </p>
                                <button onclick="location.reload()" style="
                                    background: var(--accent-color);
                                    color: white;
                                    border: none;
                                    padding: 0.5rem 1rem;
                                    border-radius: 4px;
                                    cursor: pointer;
                                    margin-top: 1rem;
                                ">Refresh Page</button>
                            </div>
                        `;
                    });
            } catch (e) {
                console.error('Error in ReDoc setup:', e);
                loadingElement.style.display = 'none';
                clearTimeout(loadingTimeout);
            }
        });
    </script>
</body>
</html> 